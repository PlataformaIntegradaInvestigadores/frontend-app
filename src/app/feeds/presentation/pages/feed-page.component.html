<div class="min-h-screen bg-gray-50">
  <app-header [showInformation]="true"></app-header>
  
  <div class="max-w-7xl mx-auto px-4 py-6">
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
      <!-- Sidebar izquierdo -->
      <aside class="lg:col-span-3 space-y-4">
        <!-- Filtros de feed (movidos aquí) -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5">
          <h3 class="text-gray-900 font-semibold mb-3">
            <i class="fas fa-filter text-blue-600 mr-2"></i>
            Filtrar feed
          </h3>
          <div class="space-y-2">
            <button 
              class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors"
              [class]="selectedFilter === 'personalized' ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-600 hover:bg-gray-50'"
              (click)="onFilterChange('personalized')">
              <i class="fas fa-home"></i>
              <span>Para ti</span>
            </button>
            <button 
              class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors"
              [class]="selectedFilter === 'trending' ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-600 hover:bg-gray-50'"
              (click)="onFilterChange('trending')">
              <i class="fas fa-fire"></i>
              <span>Tendencias</span>
            </button>
            <button 
              class="w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-colors"
              [class]="selectedFilter === 'latest' ? 'bg-blue-50 text-blue-700 border border-blue-200' : 'text-gray-600 hover:bg-gray-50'"
              (click)="onFilterChange('latest')">
              <i class="fas fa-clock"></i>
              <span>Recientes</span>
            </button>
          </div>
        </div>
        <!-- Stats del usuario -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5" *ngIf="userStats">
          <h3 class="flex items-center gap-2 text-gray-900 font-semibold mb-4">
            <i class="fas fa-chart-line text-blue-600"></i> 
            Tu actividad
          </h3>
          <div class="grid grid-cols-2 gap-4">
            <div class="text-center">
              <div class="text-2xl font-bold text-blue-600">{{ userStats.posts_count }}</div>
              <div class="text-xs text-gray-500 uppercase font-medium">Posts</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-blue-600">{{ userStats.likes_received }}</div>
              <div class="text-xs text-gray-500 uppercase font-medium">Likes</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-blue-600">{{ userStats.comments_received }}</div>
              <div class="text-xs text-gray-500 uppercase font-medium">Comentarios</div>
            </div>
            <div class="text-center">
              <div class="text-2xl font-bold text-blue-600">{{ userStats.engagement_rate | number:'1.1-1' }}%</div>
              <div class="text-xs text-gray-500 uppercase font-medium">Engagement</div>
            </div>
          </div>
        </div>

        <!-- Enlaces rápidos -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5">
          <h3 class="flex items-center gap-2 text-gray-900 font-semibold mb-4">
            <i class="fas fa-bookmark text-blue-600"></i> 
            Accesos rápidos
          </h3>
          <div class="space-y-2">
            <a href="/profile" class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors">
              <i class="fas fa-user text-gray-400"></i>
              <span class="text-gray-700">Mi perfil</span>
            </a>
            <a href="/groups" class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors">
              <i class="fas fa-users text-gray-400"></i>
              <span class="text-gray-700">Mis grupos</span>
            </a>
            <a href="/jobs" class="flex items-center gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors">
              <i class="fas fa-briefcase text-gray-400"></i>
              <span class="text-gray-700">Empleos</span>
            </a>
          </div>
        </div>
      </aside>

      <!-- Feed principal -->
      <main class="lg:col-span-6 space-y-4">
        <!-- Crear post usando el componente reutilizable -->
        <app-post-creator
          [placeholder]="'¿Qué estás pensando? Comparte algo interesante...'"
          [buttonText]="'Publicar'"
          [showOptions]="true"
          [userAvatar]="'/assets/profile.png'"
          [isLoading]="isSubmittingPost"
          (postSubmitted)="onPostSubmitted($event)">
        </app-post-creator>

        <!-- Loading state -->
        <div *ngIf="(isLoading || isSearching) && posts.length === 0" class="space-y-4">
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5 animate-pulse" *ngFor="let item of [1,2,3]">
            <div class="flex items-start gap-3">
              <div class="w-12 h-12 bg-gray-300 rounded-full"></div>
              <div class="flex-1 space-y-2">
                <div class="h-4 bg-gray-300 rounded w-1/4"></div>
                <div class="h-4 bg-gray-300 rounded w-full"></div>
                <div class="h-4 bg-gray-300 rounded w-3/4"></div>
              </div>
            </div>
          </div>
          <div class="text-center py-4" *ngIf="isSearching">
            <div class="text-blue-600 text-lg mb-2">
              <i class="fas fa-search fa-spin"></i>
            </div>
            <p class="text-gray-600">Buscando posts similares con IA...</p>
          </div>
        </div>

        <!-- Error state -->
        <div *ngIf="error" class="bg-white rounded-lg shadow-sm border border-red-200 p-8 text-center">
          <i class="fas fa-exclamation-triangle text-red-500 text-3xl mb-4"></i>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">Oops! Algo salió mal</h3>
          <p class="text-gray-600 mb-4">{{ error }}</p>
          <button 
            class="inline-flex items-center gap-2 px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
            (click)="refreshFeed()">
            <i class="fas fa-redo"></i> 
            Intentar de nuevo
          </button>
        </div>

        <!-- Empty state -->
        <div *ngIf="!isLoading && !isSearching && posts.length === 0 && !error" class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center">
          <div class="text-gray-300 text-5xl mb-4">
            <i class="fas fa-newspaper" *ngIf="!isSearchMode"></i>
            <i class="fas fa-search" *ngIf="isSearchMode"></i>
          </div>
          <h3 class="text-lg font-semibold text-gray-900 mb-2">
            {{ isSearchMode ? 'No se encontraron resultados' : '¡Tu feed está vacío!' }}
          </h3>
          <p class="text-gray-600 mb-4">
            {{ isSearchMode ? 'Intenta con otros términos de búsqueda' : 'Sigue a más personas o crea tu primer post' }}
          </p>
          <button 
            class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            (click)="isSearchMode ? clearSearch() : focusPostInput()">
            <i class="fas fa-arrow-left" *ngIf="isSearchMode"></i>
            <i class="fas fa-plus" *ngIf="!isSearchMode"></i> 
            {{ isSearchMode ? 'Volver al feed' : 'Crear mi primer post' }}
          </button>
        </div>

        <!-- Indicador de modo búsqueda -->
        <div *ngIf="isSearchMode && posts.length > 0" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-2">
              <i class="fas fa-search text-blue-600"></i>
              <span class="text-blue-800 font-medium">
                Resultados para: "{{ searchQuery }}"
              </span>
              <span class="bg-blue-200 text-blue-800 text-xs px-2 py-1 rounded-full">
                {{ posts.length }} {{ posts.length === 1 ? 'resultado' : 'resultados' }}
              </span>
            </div>
            <button 
              (click)="clearSearch()"
              class="text-blue-600 hover:text-blue-800 text-sm font-medium">
              <i class="fas fa-times mr-1"></i>
              Limpiar búsqueda
            </button>
          </div>
        </div>

        <!-- Posts feed usando el componente modular -->
        <app-post-list
          [posts]="posts"
          [isLoading]="isLoading"
          [emptyMessage]="'No hay publicaciones disponibles'"
          [showActions]="true"
          [currentUserId]="currentUserId"
          (toggleLike)="onToggleLike($event)"
          (deletePost)="onDeletePost($event)"
          (sharePost)="onSharePost($event)"
          (viewProfile)="onViewProfile($event)"
          (votePoll)="onVotePoll($event)">
        </app-post-list>

        <!-- Load more -->
        <div class="text-center" *ngIf="hasMore">
          <button 
            class="inline-flex items-center gap-2 px-6 py-3 bg-white border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
            (click)="loadMorePosts()"
            [disabled]="isLoadingMore">
            <i class="fas fa-spinner fa-spin" *ngIf="isLoadingMore"></i>
            <i class="fas fa-chevron-down" *ngIf="!isLoadingMore"></i>
            <span>{{ isLoadingMore ? 'Cargando más posts...' : 'Ver más posts' }}</span>
          </button>
        </div>

        <!-- End of feed -->
        <div class="text-center py-8" *ngIf="!hasMore && posts.length > 5">
          <div class="text-green-500 text-3xl mb-2">
            <i class="fas fa-check-circle"></i>
          </div>
          <p class="text-gray-600 mb-4">¡Ya viste todos los posts!</p>
          <button 
            class="inline-flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            (click)="refreshFeed()">
            <i class="fas fa-sync-alt"></i> 
            Actualizar feed
          </button>
        </div>
      </main>

      <!-- Sidebar derecho -->
      <aside class="lg:col-span-3 space-y-4">
        <!-- Búsqueda semántica -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-5">
          <h3 class="flex items-center gap-2 text-gray-900 font-semibold mb-3">
            <i class="fas fa-search text-blue-600"></i> 
            Búsqueda inteligente
          </h3>
          <div class="relative">
            <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
            <input 
              type="text" 
              placeholder="Buscar por contenido, temas o conceptos..."
              [(ngModel)]="searchQuery"
              (keyup.enter)="onSearch()"
              class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none">
          </div>
          <div class="mt-2 flex items-center justify-between">
            <div class="text-xs text-gray-500">
              <i class="fas fa-magic mr-1"></i>
              Búsqueda semántica con IA
            </div>
            <button 
              *ngIf="searchQuery" 
              (click)="clearSearch()"
              class="text-xs text-blue-600 hover:text-blue-800">
              Limpiar
            </button>
          </div>
        </div>
      </aside>
    </div>
  </div>
  
  <app-footer></app-footer>
</div>
